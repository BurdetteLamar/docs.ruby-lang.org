# docs.ruby-lang.org

## Platform Environment

* We use `capistrano` for deployments.
* Currently hosted on AWS EC2 Tokyo region
  * All applications run as `rurema` user.
* Periodic tasks run in cron (`crontab -u rurema`)

### Requisites

* Debian 9 (stretch)
  * `apt install nginx groonga git bundler certbot`
* passenger nginx module: https://www.phusionpassenger.com/library/install/nginx/install/oss/stretch/

## Files and Directories

* rurema-search: `/var/rubydoc`
* docs.ruby-lang.org: `/var/www/docs.ruby-lang.org`
* nginx configuration: `/etc/nginx/sites-available/docs.ruby-lang.org`

## Related repos

* https://github.com/ruby/rurema-search

## Vagrant Environment

Usage:

```
git clone https://github.com/ruby/docs.ruby-lang.org
git clone https://github.com/ruby/rurema-search
cd docs.ruby-lang.org
vagrant up
vagrant ssh-config >> ~/.ssh/config
bundle install
cap vagrant deploy
cp config/deploy/vagrant.rb ../rurema-search/config/deploy/vagrant.rb
cd ../rurema-search
cap vagrant deploy
cd ../docs.ruby-lang.org
vagrant ssh
sudo systemctl restart nginx
sudo su - rurema
crontab -l
```

- Run commands in crontab as rurema user (ignore error of `system/fastly-purge-key`)
- Open `https://localhost:10443/` in browser (ignore certificate error (`NET::ERR_CERT_AUTHORITY_INVALID`) because of using self signed certificate generated by `provision/selfsigned.yml`)
